# **FOODGRAM - PROJECT - REACT, «Продуктовый помощник».**

![Python](https://img.shields.io/badge/python-3670A0?style=for-the-badge&logo=python&logoColor=ffdd54)
![Django](https://img.shields.io/badge/django-%23092E20.svg?style=for-the-badge&logo=django&logoColor=white)
![DjangoREST](https://img.shields.io/badge/DJANGO-REST-ff1709?style=for-the-badge&logo=django&logoColor=white&color=ff1709&labelColor=gray)
![Docker](https://img.shields.io/badge/docker-%230db7ed.svg?style=for-the-badge&logo=docker&logoColor=white)
![Nginx](https://img.shields.io/badge/nginx-%23009639.svg?style=for-the-badge&logo=nginx&logoColor=white)
![Postgres](https://img.shields.io/badge/postgres-%23316192.svg?style=for-the-badge&logo=postgresql&logoColor=white)
![Gunicorn](https://img.shields.io/badge/gunicorn-%298729.svg?style=for-the-badge&logo=gunicorn&logoColor=white)
![GitHub Actions](https://img.shields.io/badge/github%20actions-%232671E5.svg?style=for-the-badge&logo=githubactions&logoColor=white)

## Описание проекта:
##### Главная страница
На странице - cписок первых шести рецептов, отсортированных по дате публикации (от новых к старым). Остальные рецепты доступны на следующих страницах: внизу страницы есть пагинация.

##### Страница рецепта
На странице - полное описание рецепта. Для авторизованных пользователей - возможность добавить рецепт в избранное и в список покупок, возможность подписаться на автора рецепта.

##### Страница пользователя
На странице - имя пользователя, все рецепты, опубликованные пользователем и возможность подписаться на пользователя.

##### Подписка на авторов
Подписка на публикации доступна только авторизованному пользователю. Страница подписок доступна только владельцу.

##### Сценарий поведения пользователя:

Пользователь переходит на страницу другого пользователя или на страницу рецепта и подписывается на публикации автора кликом по кнопке «Подписаться на автора».
Пользователь переходит на страницу «Мои подписки» и просматривает список рецептов, опубликованных теми авторами, на которых он подписался. Сортировка записей - по дате публикации (от новых к старым).
При необходимости пользователь может отказаться от подписки на автора: переходит на страницу автора или на страницу его рецепта и нажимает «Отписаться от автора».

##### Список избранного
Список избранного может просматривать только его владелец. Сценарий поведения пользователя:
Пользователь отмечает один или несколько рецептов кликом по кнопке «Добавить в избранное».
Переходит на страницу «Список избранного» и просматривает персональный список избранных рецептов. При необходимости пользователь может удалить рецепт из избранного.

##### Список покупок
Список покупок может просматривать только его владелец. Сценарий поведения пользователя:
Пользователь отмечает один или несколько рецептов кликом по кнопке «Добавить в покупки».
Пользователь переходит на страницу Список покупок, там доступны все добавленные в список рецепты. Пользователь нажимает кнопку «Скачать список» и получает файл с суммированным перечнем и количеством необходимых ингредиентов для всех рецептов, сохранённых в «Списке покупок».
При необходимости пользователь может удалить рецепт из списка покупок.
Список покупок скачивается в формате txt. При скачивании списка покупок ингредиенты в результирующем списке не дублируются; если в двух рецептах есть сахар (в одном рецепте - 333 г, в другом - 500 г), то в списке будет один пункт: Сахар - 833 г. В результате список покупок выглядит так:

```
Фарш (баранина и говядина) - 600 г
Сыр плавленый - 200 г
Лук репчатый - 50 г
```

##### Фильтрация по тегам
При нажатии на название тега выводится список рецептов, отмеченных этим тегом. Фильтрация может проводится по нескольким тегам. При фильтрации на странице пользователя фильтруются только рецепты выбранного пользователя. Такой же принцип соблюдается при фильтрации списка избранного.

##### Дизайн-макеты проекта можно посмотреть на:
[Figma.com]

## Набор доступных эндпоинтов для API Foodgram:
```
api/docs/ - подробная документация по работе API Foodgram;
api/tags/ - получение, списка тегов (GET);
api/ingredients/ - получение, списка ингредиентов (GET);
api/ingredients/ - получение ингредиента с соответствующим id (GET);
api/tags/{id} - получение, тега с соответствующим id (GET);
api/recipes/ - получение списка с рецептами и публикация рецептов (GET, POST);
api/recipes/{id} - получение, изменение, удаление рецепта с соответствующим id (GET, PUT, PATCH, DELETE);
api/recipes/{id}/shopping_cart/ - добавление рецепта с соответствующим id в список покупок и удаление из списка (GET, DELETE);
api/recipes/download_shopping_cart/ - скачать файл со списком покупок shopping_cart.txt (GET);
api/recipes/{id}/favorite/ - добавление рецепта с соответствующим id в список избранного и его удаление (GET, DELETE).
Операции с пользователями:
api/users/ - получение информации о пользователе и регистрация новых пользователей (GET, POST);
api/users/{id}/ - получение информации о пользователе (GET);
api/users/me/ - получение и изменение данных своей учётной записи. Доступна любым авторизованными пользователям (GET);
api/users/set_password/ - изменение собственного пароля (PATCH);
api/users/{id}/subscribe/ - подписаться на пользователя с соответствующим id или отписаться от него (GET, DELETE);
api/users/subscribe/subscriptions/ - просмотр пользователей на которых подписан текущий пользователь (GET).
Аутентификация и создание новых пользователей:
api/auth/token/login/ - получение токена (POST);
api/auth/token/logout/ - удаление токена (POST).
```

## Технологии:
```
Python 3.9
Django 3.2.3
Django Rest Framework 3.12.4
Djoser 2.2.0
Gunicorn 20.1.0
```

## Серверная инфраструктура:
```
Docker
PostgreSQL
Nginx
GitHub Actions
Linux Ubuntu с публичным IP
```

## Как запустить проект:

Клонировать репозиторий и перейти в него в командной строке:

```
git clone git@github.com:Val9-git/1_foodgram-project-react.git
```

```
cd backend
```

Cоздать и активировать виртуальное окружение:
```
python3 -m venv env
```

* Если у вас Linux/macOS

    ```
    source env/bin/activate
    ```

* Если у вас windows

    ```
    source env/scripts/activate
    ```

```
python3 -m pip install --upgrade pip
```

Установить зависимости из файла requirements.txt:

```
pip install -r requirements.txt
```

Выполнить миграции:

```
python3 manage.py migrate
```

Запустить проект:

```
python3 manage.py runserver
```

После выполнения вышеперечисленных инструкций проект доступен по адресу http://127.0.0.1:8000/

## Подготовка сервера и деплой проекта

Создать директорию foodgram/ в домашней директории сервера.

В корне папки foodgram поместить файл .env, заполнить его по шаблону

```
  ALLOWED_HOSTS=<Ваш домен>, <IP сервера>
  DEBUG=False

  POSTGRES_USER=...
  POSTGRES_PASSWORD=...
  POSTGRES_DB=...
  
  DB_HOST=...
  DB_PORT=...
```
Установить Nginx и настроить конфигурацию так, чтобы все запросы шли в контейнеры на порт 8000.

```
    sudo apt install nginx -y 
    sudo nano etc/nginx/sites-enabled/default
```

Пример конфигурация nginx:

```
    server {
        server_name <Ваш IP> <Домен вашего сайта>;
        server_tokens off;
        client_max_body_size 20M;
    
        location / {
            proxy_set_header Host $http_host;
            proxy_pass http://127.0.0.1:9000;
    }
```

> При необходимости настройте SSL-соединение

Установить docker и docker-compose

```
    sudo apt update
    sudo apt install curl
    curl -fSL https://get.docker.com -o get-docker.sh
    sudo sh ./get-docker.sh
    sudo apt-get install docker-compose-plugin   
```

Добавить в Secrets GitHub Actions данного репозитория на GitHub переменные окружения

```
    DOCKER_USERNAME=<имя пользователя DockerHub>
    DOCKER_PASSWORD=<пароль от DockerHub>
    
    USER=<username для подключения к удаленному серверу>
    HOST=<ip сервера>
    PASSPHRASE=<пароль для сервера, если он установлен>
    SSH_KEY=<ваш приватный SSH-ключ>
    
    TELEGRAM_TO=<id вашего Телеграм-аккаунта>
    TELEGRAM_TOKEN=<токен вашего бота>
```

Запустить workflow проекта выполнив команды:

```
  git add .
  git commit -m ''
  git push
```

> С примерами запросов можно ознакомиться в спецификации API (<your_domain>/redoc)



## Авторы:

```
frontend: Яндекс Практикум;
backend, DevOps: Valeriy Lozitskiy;
Ревьюер: Дмитрий Кубарев.
```